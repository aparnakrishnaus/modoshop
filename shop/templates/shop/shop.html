{% extends "base.html" %}

{% block title %}Shop{% endblock %}

{% block content %}
<style>
.container.py-4 {
    max-width: 1200px;
}

h2.mb-4 {
    font-weight: 700;
    font-size: 2.2rem;
    color: #333;
    margin-bottom: 2rem;
}

form.row.mb-4 input.form-control,
form.row.mb-4 select.form-select,
form.row.mb-4 button.btn {
    border: 1px solid  #fab7b7;
    border-radius: 50px;
    padding: 10px 20px;
}

form.row.mb-4 button.btn {
    background: #ff6b6b;
    border: none;
    font-weight: 600;
    transition: 0.3s;
}

form.row.mb-4 button.btn:hover {
    background: #ff4757;
}
input,select{
    box-shadow: unset !important;
}
.card {
    border: none;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    transition: transform 0.3s, box-shadow 0.3s;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.card-img-top {
    height: 200px;
    object-fit: cover;
    transition: transform 0.3s;
}

.card-img-top:hover {
    transform: scale(1.05);
}

.card-title {
    font-weight: 600;
    font-size: 1.1rem;
    color: #333;
}

.card-text {
    font-weight: 500;
    color: #666;
    margin-bottom: 0.5rem;
}

.card .btn-primary {
    background-color: #ff6b6b;
    border: none;
    transition: 0.3s;
}

.card .btn-primary:hover {
    background-color: #ff4757;
}

.card .btn-outline-secondary {
    border-color: #ff6b6b;
    color: #ff6b6b;
    transition: 0.3s;
}

.card .btn-outline-secondary:hover {
    background-color: #ff6b6b;
    color: white;
    border-color: #ff6b6b;
}

.text-center.py-5 a.btn {
    border-radius: 50px;
    padding: 8px 20px;
    transition: 0.3s;
}

.text-center.py-5 a.btn:hover {
    background-color: #ff4757;
    color: #fff;
}

</style>

<div class="container py-4">

    <h2 class="mb-4 text-center mb-5">Shop Products üõçÔ∏è</h2>

    <form id="filter-form" class="row mb-4 g-2 align-items-center">
        <div class="col-md-6">
            <input type="text" name="search" id="search-input" class="form-control" placeholder="Search products..." value="{{ request.GET.search }}"onkeyup
            ="this.form.submit()">
        </div>
        <div class="col-md-4">
            <select name="category" id="category-select" class="form-select"onchange="this.form.submit()">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
                {% endfor %}
            </select>
        </div>
        <!-- <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Filter</button>
        </div> -->
    </form>

    <!-- Product Grid -->
    <div id="product-list">
        {% include 'shop/partials/product_cards.html' %}
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    let typingTimer;
    const typingDelay = 300;

    function fetchProducts() {
        let search = $('#search-input').val();
        let category = $('#category-select').val(); 

        $.ajax({
            url: "{% url 'shop' %}",
            data: {
                'search': search,
                'category': category
            },
            headers: {'X-Requested-With': 'XMLHttpRequest'},
            dataType: 'json',
            success: function(response) {
                $('#product-list').html(response.html);
            }
        });
    }

    $('#search-input').on('keyup', function() {
        clearTimeout(typingTimer);
        typingTimer = setTimeout(fetchProducts, typingDelay);
    });
});
</script>


{% endblock %}
